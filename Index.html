<!DOCTYPE html>
<html style="width:100%; height:100%;">
    <head>
        <link rel="stylesheet" type="text/css" href="css/reset.css">       
        <script src="scripts/requirejs.js"></script>
        <script type="text/javascript">
            function f() {

                // import IsoTile and IsoCanvas modules via requirejs
                requirejs(['scripts/isotile', 'scripts/isocanvas'], function(isoTileNameSpace, isoCanvasNameSpace) {

                    var images = [
                        'Tiles/grass1.png',
                        'Tiles/grass2.png',
                        'Tiles/grass3.png',
                        'Tiles/water1.png',  
                        'Tiles/dirt1.png'
                    ];
                    var isoCanvas = new isoCanvasNameSpace.IsoCanvas(document.getElementById('isoCanvasDiv'));
                    
                    isoTileNameSpace.IsoTile.loadTileset(images, function(isoTileset) {

                        isoCanvas.tiles = isoTileset;
                        for (isotile of isoTileset) {
                            isotile.canStack = false;
                        }
                        isoTileset[isoTileset.length-1].canStack = true;

                        isoCanvas.map = generateRandomMap(isoTileset, 100, 100, 10);
                        isoCanvas.paint();
                        window.addEventListener('resize', function(ev) {
                            isoCanvas.paint();
                        });
                        document.getElementById('isoCanvasDiv').addEventListener('click', function(ev) {                                
                            isoCanvas.defaultMouseClickListener(ev);
                            isoCanvas.paint();
                        });
                        document.getElementById('isoCanvasDiv').addEventListener('wheel', function(ev) {
                            isoCanvas.defaultMouseWheelListener(ev);
                            isoCanvas.paint();
                        });
                    });               
                });

            }

            function generateRandomMap(isoTiles, width, length, maxHeight) {
                var map = []
                var height = 0;
                for (var y = 0; y < length; y++) {
                    map.push([]);
                    for (var x = 0; x < width; x++) {
                        map[y].push([]);
                        height = Math.floor(Math.random()*maxHeight);
                        for (var h = 0; h < height; h++) {
                            map[y][x].push(Math.floor(Math.random()*isoTiles.length));
                            if (isoTiles[map[y][x][h]].canStack == false) {
                                break;
                            }
                        }
                    }
                }
                return map;
            }
        
        </script>
    </head>
    <body style="width:100%; height:100%;" onload="f()">
        <div id="isoCanvasDiv" style="width:100%; height:100%;"></div>
    </body>
</html>