<!DOCTYPE html>
<html style="width:100%; height:100%;">
    <head>
        <link rel="stylesheet" type="text/css" href="css/reset.css">       
        <script src="scripts/requirejs.js"></script>
        <script type="text/javascript">
            function f() {

                // import IsoTile, IsoCanvas, and IsoTileSet modules via requirejs
                requirejs([
                    'scripts/isotile', 
                    'scripts/isocanvas',
                    'scripts/isotileset'
                ], function(isoTileNameSpace, isoCanvasNameSpace, isoTileSetNameSpace) {

                    var isoCanvas = new isoCanvasNameSpace.IsoCanvas(document.getElementById('isoCanvasDiv'));
                    var tileSet = new isoTileSetNameSpace.IsoTileSet();
                    
                    window.addEventListener('resize', function(ev) {
                        isoCanvas.paint();
                    });
                    document.getElementById('isoCanvasDiv').addEventListener('click', function(ev) {                                
                        isoCanvas.defaultMouseClickListener(ev);
                        isoCanvas.paint();
                    });
                    document.getElementById('isoCanvasDiv').addEventListener('wheel', function(ev) {
                        isoCanvas.defaultMouseWheelListener(ev);
                        isoCanvas.paint();
                    });

                    // why is this event firing twice?
                    tileSet.loadFromServer('tiles/tileset.json', () => {
                        for (tile of tileSet._isoTiles) {
                            isoCanvas.tiles.push(tile);
                        }
                        //isoCanvas.tiles = isoCanvas.tiles.concat(tileSet._isoTiles);
                        isoCanvas.generateRandomMap(100, 100, 1);
                        isoCanvas.paint();
                        
                        console.log('loaded: ', isoCanvas.tiles.length);
                    });

                });
            }       
        </script>
    </head>
    <body style="width:100%; height:100%; position: fixed" onload="f()">
        <div id="isoCanvasDiv" style="width:100%; height:100%;"></div>
    </body>
</html>