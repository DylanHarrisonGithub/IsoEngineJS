<!DOCTYPE html>
<html style="width:100%; height:100%;">
    <head>
        <link rel="stylesheet" type="text/css" href="css/reset.css">       
        <script src="scripts/requirejs.js"></script>
        <!--<script src="scripts/isotile.js"></script>
        <script src="scripts/isocanvas.js"></script>-->
        <script type="text/javascript">
            function f() {

                requirejs(['scripts/isotile', 'scripts/isocanvas'], function(isoTileNameSpace, isoCanvasNameSpace) {

                    var isoCanvas = new isoCanvasNameSpace.IsoCanvas(document.getElementById('isoCanvasDiv'));

                    // load up tiles
                    var imgs = [];
                    var loadedCounter = 0;
                    var numImages = 5;
                    for (var i = 0; i < numImages; i++) {

                        imgs.push(new Image());

                        imgs[i].onload = function() {

                            loadedCounter++;
                            if (loadedCounter == numImages) {
                                // wrap imgs as isotiles
                                var isoTiles = [];
                                for (var i = 0; i < imgs.length; i++) {
                                    isoTiles.push(new isoTileNameSpace.IsoTile(imgs[i], null));
                                    isoTiles[i].canStack = false; 
                                }            
                                isoTiles[numImages-1].canStack = true;
                                console.log(isoTiles);                   
                                isoCanvas.tiles = isoTiles;
                                isoCanvas.map = generateMap(numImages, isoTiles);
                                isoCanvas.paint();
                                window.addEventListener('resize', function(ev) {
                                    //isoCanvas.defaultResizeListener(ev);
                                    isoCanvas.paint();
                                });
                                window.addEventListener('click', function(ev) {                                
                                    isoCanvas.defaultMouseClickListener(ev);
                                    isoCanvas.paint();
                                });
                                window.addEventListener('wheel', function(ev) {
                                    isoCanvas.defaultMouseWheelListener(ev);
                                    isoCanvas.paint();
                                });
                            }
                        };
                    }
                    imgs[0].src = 'Tiles/grass1.png';
                    imgs[1].src = 'Tiles/grass2.png';
                    imgs[2].src = 'Tiles/grass3.png';
                    imgs[3].src = 'Tiles/water1.png';  
                    imgs[4].src = 'Tiles/dirt1.png';                  
                });

            }

            function generateMap(numTiles, isoTiles) {
                // generate random map
                var map = []
                var maxHeight = 12;
                var height = 0;
                for (var y = 0; y < 100; y++) {
                    map.push([]);
                    for (var x = 0; x < 100; x++) {
                        map[y].push([]);
                        height = Math.floor(Math.random()*maxHeight);
                        for (var h = 0; h < height; h++) {
                            map[y][x].push(Math.floor(Math.random()*numTiles));
                            if (isoTiles[map[y][x][h]].canStack == false) {
                                break;
                            }
                        }
                    }
                }
                return map;
            }
        

        </script>
    </head>
    <body style="width:100%; height:100%;" onload="f()">
        <div id="isoCanvasDiv" style="width:100%; height:100%;"></div>
    </body>
</html>